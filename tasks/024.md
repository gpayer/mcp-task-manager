---
id: 24
parent_id: 18
title: 'Task 6: Update CLI commands to check project exists for read operations'
status: done
priority: medium
type: feature
created_at: "2026-01-13T09:32:39Z"
updated_at: "2026-01-13T15:33:12Z"
---

**Files:**
- Modify: `internal/cli/commands.go`
- Test: `internal/cli/cli_test.go`

**Steps:**
1. Write failing test for cmdList returning error when no project found
2. Run tests to verify failure: `go test ./internal/cli/...`
3. Update `initService()` to return config as well (already does)
4. Update `cmdList` to check `cfg.ProjectFound` before listing
5. Update `cmdGet` to check `cfg.ProjectFound` before getting
6. Update `cmdNext` to check `cfg.ProjectFound` before getting next
7. If project not found, print error message and return exit code 1
8. Run tests to verify pass: `go test ./internal/cli/...`
9. Commit with message: `feat(cli): add project existence check for read commands`

**Code:**

Update commands.go with helper:
```go
// checkProjectExists verifies a project was found, returns exit code
func checkProjectExists(stderr io.Writer, cfg *config.Config) int {
    if !cfg.ProjectFound {
        fmt.Fprintln(stderr, "Error: no tasks directory found.")
        fmt.Fprintln(stderr, "Create a task to initialize one here, or set MCP_TASKS_DIR.")
        return 1
    }
    return 0
}
```

Update cmdList:
```go
func cmdList(stdout, stderr io.Writer, jsonOutput bool, status, priority, taskType string, parentID int) int {
    svc, cfg, err := initService()
    if err != nil {
        fmt.Fprintf(stderr, "Error: %v\n", err)
        return 1
    }

    // Check project exists for read operation
    if code := checkProjectExists(stderr, cfg); code != 0 {
        return code
    }

    // ... rest of existing code
}
```

Update cmdGet:
```go
func cmdGet(stdout, stderr io.Writer, jsonOutput bool, id int) int {
    svc, cfg, err := initService()
    if err != nil {
        fmt.Fprintf(stderr, "Error: %v\n", err)
        return 1
    }

    // Check project exists for read operation  
    if code := checkProjectExists(stderr, cfg); code != 0 {
        return code
    }

    // ... rest of existing code
}
```

Update cmdNext similarly.

**Verification:**
`go test ./internal/cli/... -v && go build ./cmd/mcp-task-manager && cd /tmp && mcp-task-manager list`