---
id: 20
parent_id: 18
title: 'Task 2: Update Load() to use FindProjectRoot when env var not set'
status: done
priority: medium
type: feature
created_at: "2026-01-13T09:31:54Z"
updated_at: "2026-01-13T09:50:59Z"
---

**Files:**
- Modify: `internal/config/config.go`
- Test: `internal/config/config_test.go`

**Steps:**
1. Write failing tests for Load() with upward search behavior
2. Run tests to verify failure: `go test ./internal/config/...`
3. Modify Load() to implement the config loading flow:
   - If MCP_TASKS_DIR is set: use that path, ProjectFound = true
   - If not set: call FindProjectRoot()
   - If project found: use found path, ProjectFound = true
   - If not found: use "./tasks", ProjectFound = false
4. Update Load() to also read config file from found project root (not just cwd)
5. Run tests to verify pass: `go test ./internal/config/...`
6. Commit with message: `feat(config): integrate FindProjectRoot into Load()`

**Code:**

Updated Load() function:
```go
// Load loads configuration from file and environment
func Load() (*Config, error) {
    cfg := DefaultConfig()

    // Check for env override first
    if dir := os.Getenv("MCP_TASKS_DIR"); dir != "" {
        cfg.DataDir = dir
        cfg.ProjectFound = true
        // Try to load config from that directory
        configPath := filepath.Join(dir, "..", "mcp-tasks.yaml")
        if data, err := os.ReadFile(configPath); err == nil {
            yaml.Unmarshal(data, cfg)
        }
        return cfg, nil
    }

    // Search for existing project
    projectRoot, err := FindProjectRoot()
    if err != nil {
        return nil, err
    }

    if projectRoot != "" {
        cfg.DataDir = filepath.Join(projectRoot, "tasks")
        cfg.ProjectFound = true
        // Try to load config from project root
        configPath := filepath.Join(projectRoot, "mcp-tasks.yaml")
        if data, err := os.ReadFile(configPath); err == nil {
            yaml.Unmarshal(data, cfg)
        }
    } else {
        // No project found - use cwd default
        cfg.DataDir = "./tasks"
        cfg.ProjectFound = false
        // Still try to load config from cwd
        if data, err := os.ReadFile("mcp-tasks.yaml"); err == nil {
            yaml.Unmarshal(data, cfg)
        }
    }

    return cfg, nil
}
```

**Verification:**
`go test ./internal/config/... -v`