---
id: 22
parent_id: 18
title: 'Task 4: Add EnsureProjectExists to service for read operations'
status: done
priority: medium
type: feature
created_at: "2026-01-13T09:32:16Z"
updated_at: "2026-01-13T10:00:05Z"
---

**Files:**
- Modify: `internal/task/service.go`
- Test: `internal/task/service_test.go`

**Steps:**
1. Write failing test for EnsureProjectExists() returning error when ProjectFound=false
2. Run tests to verify failure: `go test ./internal/task/...`
3. Add `EnsureProjectExists() error` method to Service
4. The method should check `s.config.ProjectFound` and return appropriate error if false
5. Run tests to verify pass: `go test ./internal/task/...`
6. Commit with message: `feat(service): add EnsureProjectExists for read validation`

**Code:**

Add to service.go:
```go
import "errors"

// ErrNoProjectFound is returned when read operations are attempted without an existing project
var ErrNoProjectFound = errors.New("no tasks directory found. Create a task to initialize one here, or set MCP_TASKS_DIR")

// EnsureProjectExists checks that a project was found during config loading.
// Should be called before read operations.
func (s *Service) EnsureProjectExists() error {
    if s.config == nil || !s.config.ProjectFound {
        return ErrNoProjectFound
    }
    return nil
}

// ProjectFound returns whether an existing project was found
func (s *Service) ProjectFound() bool {
    return s.config != nil && s.config.ProjectFound
}
```

Test code:
```go
func TestEnsureProjectExists_NoProject(t *testing.T) {
    cfg := &config.Config{ProjectFound: false}
    svc := NewService(nil, nil, nil, cfg)
    
    err := svc.EnsureProjectExists()
    if err == nil {
        t.Error("expected error when ProjectFound=false")
    }
    if err != task.ErrNoProjectFound {
        t.Errorf("expected ErrNoProjectFound, got %v", err)
    }
}

func TestEnsureProjectExists_ProjectExists(t *testing.T) {
    cfg := &config.Config{ProjectFound: true}
    svc := NewService(nil, nil, nil, cfg)
    
    err := svc.EnsureProjectExists()
    if err != nil {
        t.Errorf("expected no error when ProjectFound=true, got %v", err)
    }
}
```

**Verification:**
`go test ./internal/task/... -v -run EnsureProjectExists`