---
id: 18
title: Implement smart tasks directory discovery
status: todo
priority: medium
type: feature
created_at: "2026-01-11T15:12:37Z"
updated_at: "2026-01-11T15:12:37Z"
---

Implement intelligent tasks directory discovery to prevent accidental creation of orphan task directories.

## Design Document

See `docs/plans/2026-01-11-smart-tasks-directory-discovery-design.md` for full design details.

## Summary

1. **Upward search**: When `MCP_TASKS_DIR` is not set, search upward from cwd for `mcp-tasks.yaml` (first priority) or `tasks/` directory (second priority)
2. **Lazy creation**: Only create `tasks/` directory on write commands (`create_task`), not on read commands
3. **Clear errors**: Read commands return an error when no project is found instead of silently creating a directory

## Implementation Tasks

- Add `FindProjectRoot()` function to `internal/config/config.go`
- Add `ProjectFound` field to `Config` struct
- Modify `Load()` to use upward search when env var not set
- Remove automatic `EnsureDir()` from storage `Save()`
- Add `EnsureProjectExists()` to service layer
- Update MCP tool handlers to check project exists for read operations
- Update CLI commands to check project exists for read operations
- Add tests for upward search behavior
- Add tests for read-only command errors when no project found