---
id: 19
parent_id: 18
title: 'Task 1: Add FindProjectRoot function and ProjectFound field to config'
status: done
priority: medium
type: feature
created_at: "2026-01-13T09:31:43Z"
updated_at: "2026-01-13T09:44:52Z"
---

**Files:**
- Modify: `internal/config/config.go`
- Test: `internal/config/config_test.go`

**Steps:**
1. Write failing tests for FindProjectRoot behavior
2. Run tests to verify failure: `go test ./internal/config/...`
3. Add `ProjectFound bool` field to Config struct (with `yaml:"-"` tag)
4. Implement `FindProjectRoot() (string, error)` function that:
   - Gets current working directory
   - Iterates upward from cwd to filesystem root
   - First priority: check for `mcp-tasks.yaml` file
   - Second priority: check for `tasks/` directory
   - Returns directory path if found, empty string if not
5. Run tests to verify pass: `go test ./internal/config/...`
6. Commit with message: `feat(config): add FindProjectRoot for upward search`

**Code:**

Add to Config struct:
```go
type Config struct {
    TaskTypes    []string `yaml:"task_types"`
    DataDir      string   `yaml:"-"`
    ProjectFound bool     `yaml:"-"` // Whether an existing project was discovered
}
```

FindProjectRoot implementation:
```go
// FindProjectRoot searches for an existing project root by looking for
// mcp-tasks.yaml or a tasks directory, starting from cwd and moving up.
// Returns the directory containing the config/tasks, or empty string if not found.
func FindProjectRoot() (string, error) {
    cwd, err := os.Getwd()
    if err != nil {
        return "", err
    }

    dir := cwd
    for {
        // First priority: mcp-tasks.yaml
        if _, err := os.Stat(filepath.Join(dir, "mcp-tasks.yaml")); err == nil {
            return dir, nil
        }

        // Second priority: tasks directory
        if info, err := os.Stat(filepath.Join(dir, "tasks")); err == nil && info.IsDir() {
            return dir, nil
        }

        // Move to parent
        parent := filepath.Dir(dir)
        if parent == dir {
            // Reached filesystem root
            return "", nil
        }
        dir = parent
    }
}
```

**Verification:**
`go test ./internal/config/... -v`