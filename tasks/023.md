---
id: 23
parent_id: 18
title: 'Task 5: Update MCP tool handlers to check project exists for read operations'
status: in_progress
priority: medium
type: feature
created_at: "2026-01-13T09:32:29Z"
updated_at: "2026-01-13T10:00:15Z"
---

**Files:**
- Modify: `internal/tools/management.go`
- Modify: `internal/tools/workflow.go`

**Steps:**
1. Update `listTasksHandler` to call `svc.EnsureProjectExists()` before listing
2. Update `getTaskHandler` to call `svc.EnsureProjectExists()` before getting
3. Update `getNextTaskHandler` to call `svc.EnsureProjectExists()` before getting next task
4. If EnsureProjectExists returns error, return it via `mcp.NewToolResultError()`
5. Run manual test: start server with no tasks directory, verify list_tasks returns error
6. Commit with message: `feat(tools): add project existence check for read operations`

**Code:**

Update management.go listTasksHandler:
```go
func listTasksHandler(svc *task.Service) server.ToolHandlerFunc {
    return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
        // Check project exists for read operation
        if err := svc.EnsureProjectExists(); err != nil {
            return mcp.NewToolResultError(err.Error()), nil
        }
        
        // ... rest of existing code
    }
}
```

Update management.go getTaskHandler:
```go
func getTaskHandler(svc *task.Service) server.ToolHandlerFunc {
    return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
        // Check project exists for read operation
        if err := svc.EnsureProjectExists(); err != nil {
            return mcp.NewToolResultError(err.Error()), nil
        }
        
        id := req.GetInt("id", 0)
        // ... rest of existing code
    }
}
```

Update workflow.go getNextTaskHandler:
```go
func getNextTaskHandler(svc *task.Service) server.ToolHandlerFunc {
    return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
        // Check project exists for read operation
        if err := svc.EnsureProjectExists(); err != nil {
            return mcp.NewToolResultError(err.Error()), nil
        }
        
        t := svc.GetNextTask()
        // ... rest of existing code
    }
}
```

Note: Operations like update_task, delete_task, start_task, complete_task implicitly require an existing task, so they will naturally fail with "task not found" if no project exists.

**Verification:**
`go build ./cmd/mcp-task-manager && cd /tmp && mcp-task-manager list` (should show error about no project found)